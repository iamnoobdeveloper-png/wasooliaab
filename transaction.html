<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Font Awesome for Sidebar Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transaction - Wasooli AAB</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      background-color: #f3f8ff;
      font-family: "Poppins", sans-serif;
    }
    .sidebar {
      width: 240px;
      background-color: #2196f3;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      color: white;
      overflow-y: auto;
    }
    .sidebar ul { list-style: none; padding: 0; margin: 0; }
    .sidebar ul li {
      padding: 12px 20px;
      cursor: pointer;
      transition: 0.2s;
    }
    .sidebar ul li:hover {
      background: rgba(255,255,255,0.2);
      border-radius: 8px;
    }
    .main-content {
      margin-left: 260px;
      padding: 20px;
    }
    .btn-primary {
      background-color: #2196f3;
      border: none;
      border-radius: 8px;
    }
    .btn-primary:hover { background-color: #1976d2; }
    table th { background-color: #f1f5ff; }
    .card { border-radius: 10px; border: none; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    input.amount-input {
      width: 90px;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 2px 5px;
    }
  </style>
</head>
<body>

  <!-- SIDEBAR -->
  <div class="sidebar"></div>

  <!-- MAIN CONTENT -->
  <div class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h5 class="fw-semibold">Transactions</h5>
        <p class="text-muted mb-0">Module > Transaction</p>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-success" onclick="markMultipleReceived()">✅ Mark Selected Received</button>
        <button class="btn btn-danger" onclick="openCancelModal()">🚫 Cancel Selected</button>
      </div>
    </div>

    <!-- FILTER BAR -->
    <div class="card p-3 mb-4">
  <div class="row g-3 align-items-end">
    <div class="col-md-3">
      <label class="form-label fw-semibold">Select Area</label>
      <select id="areaFilter" class="form-select" onchange="filterTransactions()">
        <option value="All">All Areas</option>
        <option>Gulshan</option>
        <option>Johar</option>
        <option>DHA</option>
      </select>
    </div>

    <div class="col-md-3">
      <label class="form-label fw-semibold">Select Date</label>
      <input type="date" id="dateFilter" class="form-control" onchange="filterTransactions()" />
    </div>

    <div class="col-md-3">
      <label class="form-label fw-semibold">Client Type</label>
      <select id="clientTypeFilter" class="form-select" onchange="filterTransactions()">
        <option value="All">All Types</option>
        <option>House</option>
        <option>Corporate</option>
        <option>Shop</option>
    
      </select>
    </div>
  </div>
</div>

    <!-- TRANSACTION TABLE -->
    <div class="card p-3 mb-4">
      <h6 class="fw-semibold mb-3">Client Transactions</h6>
      <table class="table table-bordered align-middle" id="transactionTable">
        <thead>
          <tr>
            <th><input type="checkbox" id="selectAll" onclick="toggleAll(this)"></th>
            <th>#</th>
            <th>Client Name</th>
            <th>Client Type</th>
            <th>Area</th>
            <th>Bottles</th>
            <th>Empty Bottles Received</th>
            <th>Total Amount (PKR)</th>
            <th>Amount Received (PKR)</th>
            <th>Status</th>
            <th>Reason</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <!-- CANCEL REASON MODAL (Dropdown Added) -->
  <div class="modal fade" id="cancelReasonModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h6 class="modal-title">Cancel Selected Deliveries</h6>
          <button class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <label class="form-label fw-semibold">Select Reason for Cancellation</label>
          <select id="cancelReason" class="form-select">
            <option value="">Select Reason</option>
            <option value="Client Not Available">Client Not Available</option>
            <option value="Payment Pending">Payment Pending</option>
            <option value="Wrong Delivery Address">Wrong Delivery Address</option>
            <option value="Client Requested Delay">Client Requested Delay</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button class="btn btn-primary" onclick="applyCancelReason()">Confirm Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- SCRIPT -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>

function filterTransactions() {
  const area = document.getElementById("areaFilter").value;
  const clientType = document.getElementById("clientTypeFilter").value;
  const date = document.getElementById("dateFilter").value;

  // Dummy client types added for demonstration
  const typedTransactions = transactions.map((t, i) => ({
    ...t,
    type: i % 3 === 0 ? "House" : i % 3 === 1 ? "Corporate" : "Shop"
  }));

  let filtered = typedTransactions;

  if (area !== "All") {
    filtered = filtered.filter(t => t.area === area);
  }

  if (clientType !== "All") {
    filtered = filtered.filter(t => t.type === clientType);
  }

  // Optionally you can filter by date if needed later
  loadTransactions(filtered);
}
















   const transactions = [
  { name: "Imran Ali", area: "Gulshan", bottles: 10, emptyReceived: 10, amount: 1000, received: 1000, status: "Pending", reason: "" },
  { name: "Hassan Raza", area: "Gulshan", bottles: 8, emptyReceived: 6, amount: 800, received: 600, status: "Pending", reason: "" },
  { name: "Bilal Ahmed", area: "Gulshan", bottles: 15, emptyReceived: 10, amount: 1500, received: 1200, status: "Pending", reason: "" },
  { name: "Taha Siddiqui", area: "Johar", bottles: 12, emptyReceived: 12, amount: 1200, received: 1200, status: "Pending", reason: "" },
  { name: "Zain Khan", area: "Johar", bottles: 9, emptyReceived: 7, amount: 900, received: 700, status: "Pending", reason: "" },
  { name: "Umair Qureshi", area: "DHA", bottles: 11, emptyReceived: 9, amount: 1100, received: 900, status: "Pending", reason: "" },
  { name: "Arsalan Sheikh", area: "DHA", bottles: 14, emptyReceived: 12, amount: 1400, received: 1400, status: "Pending", reason: "" },
  { name: "Kashif Iqbal", area: "Clifton", bottles: 10, emptyReceived: 10, amount: 1000, received: 1000, status: "Pending", reason: "" },
  { name: "Adnan Malik", area: "Clifton", bottles: 16, emptyReceived: 15, amount: 1600, received: 1600, status: "Pending", reason: "" },
  { name: "Javed Ahmed", area: "Gulshan", bottles: 7, emptyReceived: 6, amount: 700, received: 700, status: "Pending", reason: "" },
  { name: "Farhan Tariq", area: "Johar", bottles: 13, emptyReceived: 11, amount: 1300, received: 1100, status: "Pending", reason: "" },
  { name: "Ali Rehman", area: "DHA", bottles: 10, emptyReceived: 10, amount: 1000, received: 1000, status: "Pending", reason: "" },
  { name: "Furqan Ahmed", area: "Clifton", bottles: 18, emptyReceived: 17, amount: 1800, received: 1500, status: "Pending", reason: "" },
  { name: "Danish Noor", area: "Gulshan", bottles: 9, emptyReceived: 9, amount: 900, received: 900, status: "Pending", reason: "" },
  { name: "Saad Jameel", area: "Johar", bottles: 20, emptyReceived: 19, amount: 2000, received: 1800, status: "Pending", reason: "" },
  { name: "Rizwan Latif", area: "DHA", bottles: 8, emptyReceived: 7, amount: 800, received: 600, status: "Pending", reason: "" },
  { name: "Irfan Ansari", area: "DHA", bottles: 22, emptyReceived: 22, amount: 2200, received: 2000, status: "Pending", reason: "" },
  { name: "Mohsin Rafiq", area: "Clifton", bottles: 12, emptyReceived: 11, amount: 1200, received: 1100, status: "Pending", reason: "" },
  { name: "Nouman Zafar", area: "Gulshan", bottles: 19, emptyReceived: 18, amount: 1900, received: 1600, status: "Pending", reason: "" },
  { name: "Hamza Butt", area: "Johar", bottles: 10, emptyReceived: 9, amount: 1000, received: 900, status: "Pending", reason: "" },
  { name: "Qasim Mehmood", area: "DHA", bottles: 17, emptyReceived: 15, amount: 1700, received: 1600, status: "Pending", reason: "" },
  { name: "Rehan Farooq", area: "Clifton", bottles: 25, emptyReceived: 25, amount: 2500, received: 2500, status: "Pending", reason: "" },

  // 👇 Added dummy data
  { name: "Salman Yusuf", area: "Gulshan", bottles: 13, emptyReceived: 12, amount: 1300, received: 1200, status: "Pending", reason: "" },
  { name: "Ahmad Nadeem", area: "Johar", bottles: 11, emptyReceived: 9, amount: 1100, received: 1000, status: "Pending", reason: "" },
  { name: "Faisal Khan", area: "DHA", bottles: 19, emptyReceived: 18, amount: 1900, received: 1700, status: "Pending", reason: "" },
  { name: "Rameez Shah", area: "Clifton", bottles: 8, emptyReceived: 7, amount: 800, received: 700, status: "Pending", reason: "" },
  { name: "Tariq Jamil", area: "Gulshan", bottles: 14, emptyReceived: 13, amount: 1400, received: 1300, status: "Pending", reason: "" },
  { name: "Hamad Aslam", area: "Johar", bottles: 18, emptyReceived: 17, amount: 1800, received: 1700, status: "Pending", reason: "" },
  { name: "Osama Baig", area: "DHA", bottles: 16, emptyReceived: 14, amount: 1600, received: 1500, status: "Pending", reason: "" },
  { name: "Saeed Akhtar", area: "Clifton", bottles: 21, emptyReceived: 20, amount: 2100, received: 2000, status: "Pending", reason: "" },
  { name: "Noman Tariq", area: "Gulshan", bottles: 10, emptyReceived: 9, amount: 1000, received: 800, status: "Pending", reason: "" },
  { name: "Shahzaib Ali", area: "Johar", bottles: 15, emptyReceived: 13, amount: 1500, received: 1400, status: "Pending", reason: "" },
  { name: "Adeel Farooq", area: "DHA", bottles: 9, emptyReceived: 8, amount: 900, received: 800, status: "Pending", reason: "" },
  { name: "Rizvi Haider", area: "Clifton", bottles: 14, emptyReceived: 14, amount: 1400, received: 1400, status: "Pending", reason: "" },
  { name: "Haris Malik", area: "Gulshan", bottles: 17, emptyReceived: 15, amount: 1700, received: 1500, status: "Pending", reason: "" },
  { name: "Imtiaz Noor", area: "Johar", bottles: 22, emptyReceived: 21, amount: 2200, received: 2000, status: "Pending", reason: "" },
  { name: "Ahsan Javed", area: "DHA", bottles: 20, emptyReceived: 18, amount: 2000, received: 1900, status: "Pending", reason: "" },
  { name: "Nadeem Shahid", area: "Clifton", bottles: 13, emptyReceived: 12, amount: 1300, received: 1200, status: "Pending", reason: "" },
  { name: "Owais Mirza", area: "Gulshan", bottles: 12, emptyReceived: 11, amount: 1200, received: 1100, status: "Pending", reason: "" },
  { name: "Asim Khalid", area: "Johar", bottles: 19, emptyReceived: 17, amount: 1900, received: 1800, status: "Pending", reason: "" },
  { name: "Kamran Saleem", area: "DHA", bottles: 24, emptyReceived: 23, amount: 2400, received: 2300, status: "Pending", reason: "" },
  { name: "Waseem Arif", area: "Clifton", bottles: 11, emptyReceived: 9, amount: 1100, received: 900, status: "Pending", reason: "" },
  { name: "Nashit Abbas", area: "Johar", bottles: 10, emptyReceived: 8, amount: 1000, received: 900, status: "Pending", reason: "" },
];

const tableBody = document.querySelector("#transactionTable tbody");
let selectedForCancel = [];

// ✅ On Page Load — no data shown
document.addEventListener("DOMContentLoaded", () => {
  const today = new Date().toISOString().split("T")[0];
  document.getElementById("dateFilter").value = today;
  tableBody.innerHTML = `<tr><td colspan="10" class="text-center text-muted py-3">Please select Area and Date to view transactions.</td></tr>`;
});

// ✅ Load filtered transactions only when Area and Date are selected
function filterTransactions() {
  const area = document.getElementById("areaFilter").value;
  const date = document.getElementById("dateFilter").value;
  const clientType = document.getElementById("clientTypeFilter").value;

  if (area === "All" || !area || !date) {
    tableBody.innerHTML = `<tr><td colspan="10" class="text-center text-muted py-3">Please select Area and Date to view transactions.</td></tr>`;
    return;
  }

  // Dummy client types just for filtering
  const typedTransactions = transactions.map((t, i) => ({
    ...t,
    type: i % 3 === 0 ? "Regular" : i % 3 === 1 ? "Corporate" : "VIP"
  }));

  let filtered = typedTransactions.filter(t => t.area === area);

  if (clientType !== "All") {
    filtered = filtered.filter(t => t.type === clientType);
  }

  if (filtered.length === 0) {
    tableBody.innerHTML = `<tr><td colspan="10" class="text-center text-muted py-3">No transactions found for selected filters.</td></tr>`;
  } else {
    loadTransactions(filtered);
  }
}

// ✅ Load Data to Table
function loadTransactions(list) {
  tableBody.innerHTML = "";
  list.forEach((t, i) => {
    tableBody.innerHTML += `
      <tr>
        <td><input type="checkbox" class="rowCheckbox" data-index="${i}"></td>
        <td>${i + 1}</td>
        <td>${t.name}</td>
        <td>${t.area}</td>
        <td>${t.bottles}</td>
        <td><input type="number" class="amount-input" id="empty_${i}" value="${t.emptyReceived}" onchange="updateEmptyReceived(${i}, this.value)"></td>
        <td>${t.amount}</td>
        <td><input type="number" class="amount-input" id="received_${i}" value="${t.received}" onchange="updateReceived(${i}, this.value)"></td>
        <td><span class="badge bg-${t.status === 'Received' ? 'success' : (t.status === 'Canceled' ? 'danger' : 'warning')}">${t.status}</span></td>
        <td>${t.reason || '-'}</td>
      </tr>`;
  });
}

    function updateReceived(index, value) {
      transactions[index].received = parseFloat(value) || 0;
    }

    function updateEmptyReceived(index, value) {
      transactions[index].emptyReceived = parseInt(value) || 0;
    }

    // Filter area and date
    function filterByArea() {
      const area = document.getElementById("areaFilter").value;
      const filtered = area === "All" ? transactions : transactions.filter(t => t.area === area);
      loadTransactions(filtered);
    }

    // Select all
    function toggleAll(mainCheckbox) {
      document.querySelectorAll(".rowCheckbox").forEach(cb => cb.checked = mainCheckbox.checked);
    }

    // Get selected indexes
    function getSelectedIndexes() {
      const selected = [];
      document.querySelectorAll(".rowCheckbox:checked").forEach(cb => selected.push(parseInt(cb.dataset.index)));
      return selected;
    }

    function markMultipleReceived() {
      const indexes = getSelectedIndexes();
      if (!indexes.length) return alert("⚠️ No clients selected.");
      indexes.forEach(i => transactions[i].status = "Received");
      alert(`✅ ${indexes.length} client(s) marked as received.`);
      filterByArea();
    }

    function openCancelModal() {
      selectedForCancel = getSelectedIndexes();
      if (!selectedForCancel.length) return alert("⚠️ No clients selected.");
      document.getElementById("cancelReason").value = "";
      const modal = new bootstrap.Modal(document.getElementById("cancelReasonModal"));
      modal.show();
    }

    function applyCancelReason() {
      const reason = document.getElementById("cancelReason").value.trim();
      if (!reason) return alert("⚠️ Please select a reason.");

      selectedForCancel.forEach(i => {
        transactions[i].status = "Canceled";
        transactions[i].amount = 0;
        transactions[i].received = 0;
        transactions[i].emptyReceived = 0;
        transactions[i].reason = reason;
      });

      alert(`🚫 ${selectedForCancel.length} client(s) deliveries canceled with reason: "${reason}"`);
      filterByArea();

      const modal = bootstrap.Modal.getInstance(document.getElementById("cancelReasonModal"));
      modal.hide();
    }
  </script>

<script src="sidebar.js"></script>
</body>
</html>

